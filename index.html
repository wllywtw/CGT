<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Win Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="m-0 p-0 overflow-x-hidden">
    <div id="app"></div>

    <script type="module">
        const { useState, useEffect, createElement: h } = React;

        function TeamPredictor() {
            const [matchData, setMatchData] = useState(null);
            const [team1, setTeam1] = useState(null);
            const [team2, setTeam2] = useState(null);
            const [predictions, setPredictions] = useState(null);
            const [matchHistory, setMatchHistory] = useState([]);
            const [error, setError] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadData();
            }, []);

            useEffect(() => {
                if (team1 && team2 && matchHistory.length > 0) {
                    calculatePredictions();
                }
            }, [team1, team2, matchHistory]);

            const loadData = async () => {
                setLoading(true);
                setError(null);
                
                try {
                    const historyData = localStorage.getItem('match-history');
                    if (historyData) {
                        setMatchHistory(JSON.parse(historyData));
                    }

                    const response = await fetch('./data.json');
                    
                    if (!response.ok) {
                        throw new Error('data.json not found. Please create a data.json file in the same directory.');
                    }

                    const data = await response.json();
                    
                    if (!data.team1 || !data.team2) {
                        throw new Error('Invalid JSON: Must contain team1 and team2');
                    }

                    setMatchData(data);
                    setTeam1(data.team1);
                    setTeam2(data.team2);
                    setError(null);
                } catch (err) {
                    setError(err.message);
                    console.error('Error loading data:', err);
                } finally {
                    setLoading(false);
                }
            };

            const saveMatchHistory = (history) => {
                try {
                    localStorage.setItem('match-history', JSON.stringify(history));
                } catch (err) {
                    console.error('Failed to save match history:', err);
                }
            };

            const calculatePredictions = () => {
                const team1Stats = getTeamStats(team1.name);
                const team2Stats = getTeamStats(team2.name);

                if (team1Stats.total === 0 && team2Stats.total === 0) {
                    setPredictions(null);
                    return;
                }

                let team1Score = 0;
                let team2Score = 0;

                if (team1Stats.total > 0) {
                    const team1WinRate = (team1Stats.wins / team1Stats.total) * 100;
                    team1Score += team1WinRate * 0.4;
                } else {
                    team1Score += 50 * 0.4;
                }
                if (team2Stats.total > 0) {
                    const team2WinRate = (team2Stats.wins / team2Stats.total) * 100;
                    team2Score += team2WinRate * 0.4;
                } else {
                    team2Score += 50 * 0.4;
                }

                const h2h = matchHistory.filter(m => 
                    (m.team1 === team1.name && m.team2 === team2.name) ||
                    (m.team1 === team2.name && m.team2 === team1.name)
                );
                
                if (h2h.length > 0) {
                    const team1H2HWins = h2h.filter(m => m.winner === team1.name).length;
                    const team2H2HWins = h2h.filter(m => m.winner === team2.name).length;
                    const team1H2HRate = (team1H2HWins / h2h.length) * 100;
                    const team2H2HRate = (team2H2HWins / h2h.length) * 100;
                    team1Score += team1H2HRate * 0.3;
                    team2Score += team2H2HRate * 0.3;
                } else {
                    team1Score += 50 * 0.3;
                    team2Score += 50 * 0.3;
                }

                if (team1.players && team1.players.length > 0) {
                    const team1Avg = team1.players.reduce((sum, p) => sum + (p.skill || 50), 0) / team1.players.length;
                    team1Score += team1Avg * 0.3;
                } else {
                    team1Score += 50 * 0.3;
                }
                
                if (team2.players && team2.players.length > 0) {
                    const team2Avg = team2.players.reduce((sum, p) => sum + (p.skill || 50), 0) / team2.players.length;
                    team2Score += team2Avg * 0.3;
                } else {
                    team2Score += 50 * 0.3;
                }

                const total = team1Score + team2Score;
                const team1Percentage = Math.round((team1Score / total) * 100);
                const team2Percentage = Math.round((team2Score / total) * 100);

                setPredictions({
                    team1Percentage,
                    team2Percentage,
                    team1Stats,
                    team2Stats,
                    headToHead: h2h.length
                });
            };

            const getTeamStats = (teamName) => {
                const wins = matchHistory.filter(m => m.winner === teamName).length;
                const losses = matchHistory.filter(m => 
                    (m.team1 === teamName || m.team2 === teamName) && m.winner !== teamName
                ).length;
                return { wins, losses, total: wins + losses };
            };

            const recordWinner = (winnerName) => {
                const newMatch = {
                    team1: team1.name,
                    team2: team2.name,
                    winner: winnerName,
                    date: new Date().toISOString()
                };
                
                const newHistory = [newMatch, ...matchHistory];
                setMatchHistory(newHistory);
                saveMatchHistory(newHistory);
            };

            const resetHistory = () => {
                if (confirm('Reset all match history?')) {
                    setMatchHistory([]);
                    localStorage.removeItem('match-history');
                    setPredictions(null);
                }
            };

            if (loading) {
                return h('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center' },
                    h('div', { className: 'text-center' },
                        h('div', { className: 'animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-purple-500 mx-auto mb-4' }),
                        h('p', { className: 'text-white text-xl' }, 'Loading data.json...')
                    )
                );
            }

            if (error) {
                return h('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-8' },
                    h('div', { className: 'bg-white bg-opacity-10 backdrop-blur-lg rounded-3xl p-12 border border-white border-opacity-20 max-w-2xl w-full text-center' },
                        h('div', { className: 'text-red-400 text-6xl mb-6' }, '‚ö†Ô∏è'),
                        h('h1', { className: 'text-4xl font-bold text-white mb-4' }, 'Error Loading Data'),
                        h('button', {
                            onClick: loadData,
                            className: 'bg-gradient-to-r from-purple-500 to-pink-500 text-white py-4 px-8 rounded-xl font-bold text-lg hover:from-purple-600 hover:to-pink-600 transition-all'
                        }, 'üîÑ Retry')
                    )
                );
            }

            if (!team1 || !team2) return null;

            return h('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 relative' },
                // Top Bar
                h('div', { className: 'absolute top-0 left-0 right-0 p-6 flex justify-between items-center z-10' },
                    h('button', {
                        onClick: loadData,
                        className: 'bg-white bg-opacity-10 backdrop-blur-lg px-6 py-3 rounded-xl border border-white border-opacity-20 hover:bg-opacity-20 transition-all text-white font-semibold'
                    }, 'üîÑ Reload Data'),
                    h('button', {
                        onClick: resetHistory,
                        className: 'bg-red-500 bg-opacity-20 backdrop-blur-lg px-6 py-3 rounded-xl border border-red-500 border-opacity-50 hover:bg-opacity-30 transition-all text-red-300 font-semibold'
                    }, 'Reset History')
                ),
                // Main Content
                h('div', { className: 'min-h-screen flex flex-col' },
                    // Team 1 - Top Half
                    h('div', { className: 'flex-1 flex items-center justify-center p-12 border-b-4 border-white border-opacity-20 relative overflow-hidden' },
                        h('div', { className: 'absolute inset-0 bg-gradient-to-br from-blue-900 from-opacity-30 to-cyan-900 to-opacity-30' }),
                        h('div', { className: 'relative z-10 text-center' },
                            // Profile Picture
                            h('div', { className: 'w-64 h-64 mx-auto mb-8 rounded-full bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center shadow-2xl overflow-hidden' },
                                team1.image ? 
                                    h('img', { 
                                        src: team1.image, 
                                        alt: team1.name,
                                        className: 'w-full h-full object-cover',
                                        onError: (e) => {
                                            e.target.style.display = 'none';
                                            e.target.parentElement.innerHTML = '<span class="text-8xl">üèÜ</span>';
                                        }
                                    }) :
                                    h('span', { className: 'text-8xl' }, 'üèÜ')
                            ),
                            // Team Name
                            h('h2', { className: 'text-6xl font-black text-white drop-shadow-2xl mb-8 uppercase tracking-wider' }, team1.name),
                            // Players
                            team1.players && team1.players.length > 0 && h('div', { className: 'mb-8 space-y-3' },
                                team1.players.map((player, idx) =>
                                    h('div', { key: idx, className: 'bg-white bg-opacity-10 backdrop-blur-lg rounded-xl px-6 py-3 inline-block mx-2 border border-white border-opacity-20' },
                                        h('span', { className: 'text-white font-semibold text-lg' }, player.name),
                                        player.skill && h('span', { className: 'ml-3 text-cyan-300 font-bold' }, player.skill)
                                    )
                                )
                            ),
                            // Win Percentage or No Data
                            predictions ? 
                                h('div', { className: 'space-y-4' },
                                    h('div', { className: 'text-9xl font-black text-white drop-shadow-2xl animate-pulse' }, predictions.team1Percentage + '%'),
                                    h('div', { className: 'text-cyan-200 text-2xl font-semibold' }, `${predictions.team1Stats.wins}W - ${predictions.team1Stats.losses}L`),
                                    predictions.headToHead > 0 && h('div', { className: 'text-cyan-300 text-lg' }, `${predictions.headToHead} head-to-head matches`)
                                ) :
                                h('div', { className: 'space-y-4' },
                                    h('div', { className: 'text-5xl font-bold text-cyan-300 drop-shadow-lg' }, 'NO DATA'),
                                    h('div', { className: 'text-cyan-400 text-xl' }, 'Record matches to see predictions')
                                )
                        )
                    ),
                    // VS Divider
                    h('div', { className: 'absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20' },
                        h('div', { className: 'bg-gradient-to-r from-purple-500 to-pink-500 rounded-full w-32 h-32 flex items-center justify-center shadow-2xl border-4 border-white border-opacity-20' },
                            h('span', { className: 'text-white text-4xl font-black' }, 'VS')
                        )
                    ),
                    // Team 2 - Bottom Half
                    h('div', { className: 'flex-1 flex items-center justify-center p-12 relative overflow-hidden' },
                        h('div', { className: 'absolute inset-0 bg-gradient-to-br from-pink-900 from-opacity-30 to-rose-900 to-opacity-30' }),
                        h('div', { className: 'relative z-10 text-center' },
                            // Win Percentage or No Data
                            predictions ? 
                                h('div', { className: 'space-y-4 mb-8' },
                                    h('div', { className: 'text-9xl font-black text-white drop-shadow-2xl animate-pulse' }, predictions.team2Percentage + '%'),
                                    h('div', { className: 'text-pink-200 text-2xl font-semibold' }, `${predictions.team2Stats.wins}W - ${predictions.team2Stats.losses}L`)
                                ) :
                                h('div', { className: 'space-y-4 mb-8' },
                                    h('div', { className: 'text-5xl font-bold text-pink-300 drop-shadow-lg' }, 'NO DATA'),
                                    h('div', { className: 'text-pink-400 text-xl' }, 'Record matches to see predictions')
                                ),
                            // Players
                            team2.players && team2.players.length > 0 && h('div', { className: 'mb-8 space-y-3' },
                                team2.players.map((player, idx) =>
                                    h('div', { key: idx, className: 'bg-white bg-opacity-10 backdrop-blur-lg rounded-xl px-6 py-3 inline-block mx-2 border border-white border-opacity-20' },
                                        h('span', { className: 'text-white font-semibold text-lg' }, player.name),
                                        player.skill && h('span', { className: 'ml-3 text-pink-300 font-bold' }, player.skill)
                                    )
                                )
                            ),
                            // Team Name
                            h('h2', { className: 'text-6xl font-black text-white drop-shadow-2xl mb-8 uppercase tracking-wider' }, team2.name),
                            // Profile Picture
                            h('div', { className: 'w-64 h-64 mx-auto rounded-full bg-gradient-to-br from-pink-500 to-rose-400 flex items-center justify-center shadow-2xl overflow-hidden' },
                                team2.image ? 
                                    h('img', { 
                                        src: team2.image, 
                                        alt: team2.name,
                                        className: 'w-full h-full object-cover',
                                        onError: (e) => {
                                            e.target.style.display = 'none';
                                            e.target.parentElement.innerHTML = '<span class="text-8xl">üèÜ</span>';
                                        }
                                    }) :
                                    h('span', { className: 'text-8xl' }, 'üèÜ')
                            )
                        )
                    )
                ),
                // Record Winner Buttons
                h('div', { className: 'absolute bottom-8 left-8 right-8 grid grid-cols-2 gap-6 z-20' },
                    h('button', {
                        onClick: () => recordWinner(team1.name),
                        className: 'py-6 rounded-2xl font-bold text-2xl text-white bg-gradient-to-r from-blue-500 to-cyan-400 hover:opacity-90 hover:scale-105 transition-all shadow-2xl flex items-center justify-center gap-3'
                    }, 'üèÜ ' + team1.name + ' Won'),
                    h('button', {
                        onClick: () => recordWinner(team2.name),
                        className: 'py-6 rounded-2xl font-bold text-2xl text-white bg-gradient-to-r from-pink-500 to-rose-400 hover:opacity-90 hover:scale-105 transition-all shadow-2xl flex items-center justify-center gap-3'
                    }, 'üèÜ ' + team2.name + ' Won')
                ),
                // Stats Sidebar
                matchHistory.length > 0 && h('div', { className: 'absolute right-8 top-24 bottom-24 w-80 bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border border-white border-opacity-20 overflow-y-auto' },
                    h('h3', { className: 'text-white font-bold text-xl mb-4' }, 'üìä Match History'),
                    h('div', { className: 'space-y-3' },
                        matchHistory.slice(0, 20).map((match, idx) =>
                            h('div', { key: idx, className: 'bg-white bg-opacity-10 rounded-lg p-3 border border-white border-opacity-20' },
                                h('div', { className: 'text-white text-sm font-semibold mb-1' }, `${match.team1} vs ${match.team2}`),
                                h('div', { className: 'text-green-400 text-xs font-bold' }, `Winner: ${match.winner}`)
                            )
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('app'));
        root.render(React.createElement(TeamPredictor));
    </script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</body>
</html>
