<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Team Win Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="m-0 p-0 overflow-x-hidden bg-slate-950 text-slate-100">
    <div id="app"></div>

    <!-- React and ReactDOM first -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- App code -->
    <script type="module">
        const { useState, useEffect, createElement: h } = React;

        function TeamPredictor() {
            const [matchData, setMatchData] = useState(null);
            const [team1, setTeam1] = useState(null);
            const [team2, setTeam2] = useState(null);
            const [predictions, setPredictions] = useState(null);
            const [matchHistory, setMatchHistory] = useState([]);
            const [error, setError] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadData();
            }, []);

            useEffect(() => {
                if (team1 && team2 && matchHistory.length > 0) {
                    calculatePredictions();
                }
            }, [team1, team2, matchHistory]);

            const loadData = async () => {
                setLoading(true);
                setError(null);

                try {
                    const response = await fetch('./data.json');

                    if (!response.ok) {
                        throw new Error('data.json not found. Please create a data.json file in the same directory.');
                    }

                    const data = await response.json();

                    if (!data.team1 || !data.team2) {
                        throw new Error('Invalid JSON: Must contain team1 and team2');
                    }

                    setMatchData(data);
                    setTeam1(data.team1);
                    setTeam2(data.team2);

                    // Match history is read-only from data.json (matches or matchHistory)
                    const history = data.matches || data.matchHistory || [];
                    setMatchHistory(Array.isArray(history) ? history : []);

                    setError(null);
                } catch (err) {
                    setError(err.message);
                    console.error('Error loading data:', err);
                } finally {
                    setLoading(false);
                }
            };

            const calculatePredictions = () => {
                const team1Stats = getTeamStats(team1.name);
                const team2Stats = getTeamStats(team2.name);

                if (team1Stats.total === 0 && team2Stats.total === 0) {
                    setPredictions(null);
                    return;
                }

                let team1Score = 0;
                let team2Score = 0;

                // Win rate weight: 40%
                if (team1Stats.total > 0) {
                    const team1WinRate = (team1Stats.wins / team1Stats.total) * 100;
                    team1Score += team1WinRate * 0.4;
                } else {
                    team1Score += 50 * 0.4;
                }

                if (team2Stats.total > 0) {
                    const team2WinRate = (team2Stats.wins / team2Stats.total) * 100;
                    team2Score += team2WinRate * 0.4;
                } else {
                    team2Score += 50 * 0.4;
                }

                // Head-to-head weight: 30%
                const h2h = matchHistory.filter(m =>
                    (m.team1 === team1.name && m.team2 === team2.name) ||
                    (m.team1 === team2.name && m.team2 === team1.name)
                );

                if (h2h.length > 0) {
                    const team1H2HWins = h2h.filter(m => m.winner === team1.name).length;
                    const team2H2HWins = h2h.filter(m => m.winner === team2.name).length;
                    const team1H2HRate = (team1H2HWins / h2h.length) * 100;
                    const team2H2HRate = (team2H2HWins / h2h.length) * 100;
                    team1Score += team1H2HRate * 0.3;
                    team2Score += team2H2HRate * 0.3;
                } else {
                    team1Score += 50 * 0.3;
                    team2Score += 50 * 0.3;
                }

                // Player skills weight: 30%
                if (team1.players && team1.players.length > 0) {
                    const team1Avg = team1.players.reduce((sum, p) => sum + (p.skill || 50), 0) / team1.players.length;
                    team1Score += team1Avg * 0.3;
                } else {
                    team1Score += 50 * 0.3;
                }

                if (team2.players && team2.players.length > 0) {
                    const team2Avg = team2.players.reduce((sum, p) => sum + (p.skill || 50), 0) / team2.players.length;
                    team2Score += team2Avg * 0.3;
                } else {
                    team2Score += 50 * 0.3;
                }

                const total = team1Score + team2Score;
                const team1Percentage = Math.round((team1Score / total) * 100);
                const team2Percentage = Math.round((team2Score / total) * 100);

                setPredictions({
                    team1Percentage,
                    team2Percentage,
                    team1Stats,
                    team2Stats,
                    headToHead: h2h.length
                });
            };

            const getTeamStats = (teamName) => {
                const wins = matchHistory.filter(m => m.winner === teamName).length;
                const losses = matchHistory.filter(m =>
                    (m.team1 === teamName || m.team2 === teamName) && m.winner !== teamName
                ).length;
                return { wins, losses, total: wins + losses };
            };

            if (loading) {
                return h(
                    'div',
                    { className: 'min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 flex items-center justify-center' },
                    h('div', { className: 'text-center' },
                        h('div', { className: 'animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-violet-500 mx-auto mb-4' }),
                        h('p', { className: 'text-slate-100 text-xl tracking-wide' }, 'Loading data.json...')
                    )
                );
            }

            if (error) {
                return h(
                    'div',
                    { className: 'min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 flex items-center justify-center p-8' },
                    h('div', {
                        className:
                            'bg-slate-900/80 backdrop-blur-xl rounded-3xl p-10 border border-slate-700/70 max-w-xl w-full text-center shadow-2xl'
                    },
                        h('div', { className: 'text-red-400 text-5xl mb-4' }, '‚ö†Ô∏è'),
                        h('h1', { className: 'text-3xl font-bold text-slate-50 mb-2' }, 'Error Loading Data'),
                        h('p', { className: 'text-slate-400 mb-6 text-sm' }, error),
                        h('button', {
                            onClick: loadData,
                            className:
                                'bg-gradient-to-r from-violet-500 to-fuchsia-500 text-white py-3 px-8 rounded-xl font-semibold text-sm tracking-wide hover:from-violet-600 hover:to-fuchsia-600 transition-all'
                        }, 'Retry')
                    )
                );
            }

            if (!team1 || !team2) return null;

            return h(
                'div',
                { className: 'min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 relative' },
                // Main Content - Horizontal Layout
                h(
                    'div',
                    { className: 'min-h-screen flex items-center justify-center p-6' },
                    h(
                        'div',
                        { className: 'flex items-stretch gap-8 max-w-6xl w-full' },
                        // Team 1 Card
                        h(
                            'div',
                            {
                                className:
                                    'flex-1 bg-slate-900/70 backdrop-blur-xl rounded-3xl p-8 border border-slate-700/70 text-center ' +
                                    'shadow-2xl hover:shadow-violet-900/40 transform hover:-translate-y-1 transition-all'
                            },
                            // Profile Picture
                            h(
                                'div',
                                {
                                    className:
                                        'w-32 h-32 mx-auto mb-6 rounded-3xl bg-gradient-to-br from-violet-500 to-sky-500 ' +
                                        'flex items-center justify-center shadow-2xl overflow-hidden border border-slate-800'
                                },
                                team1.image
                                    ? h('img', {
                                        src: team1.image,
                                        alt: team1.name,
                                        className: 'w-full h-full object-cover',
                                        onError: (e) => {
                                            e.target.style.display = 'none';
                                            e.target.parentElement.innerHTML = '<span class="text-4xl text-white">üèÜ</span>';
                                        }
                                    })
                                    : h('span', { className: 'text-4xl text-white' }, 'üèÜ')
                            ),
                            // Team Name
                            h(
                                'h2',
                                {
                                    className:
                                        'text-3xl font-extrabold text-slate-50 mb-2 tracking-[0.18em] uppercase'
                                },
                                team1.name
                            ),
                            h('p', { className: 'text-xs uppercase tracking-[0.25em] text-slate-500 mb-6' }, 'Team One'),
                            // Players
                            team1.players &&
                                team1.players.length > 0 &&
                                h(
                                    'div',
                                    { className: 'mb-6 space-y-2' },
                                    team1.players.map((player, idx) =>
                                        h(
                                            'div',
                                            {
                                                key: idx,
                                                className:
                                                    'flex items-center justify-between bg-slate-900/80 rounded-xl px-4 py-2 ' +
                                                    'border border-slate-700/80'
                                            },
                                            h('span', { className: 'text-sm text-slate-100 font-medium' }, player.name),
                                            player.skill &&
                                            h(
                                                'span',
                                                { className: 'ml-2 text-xs text-sky-300 font-semibold' },
                                                'Skill: ' + player.skill
                                            )
                                        )
                                    )
                                ),
                            // Prediction / Stats
                            predictions
                                ? h(
                                    'div',
                                    { className: 'space-y-3' },
                                    h(
                                        'div',
                                        {
                                            className:
                                                'text-5xl font-black text-slate-50 animate-pulse tracking-tight'
                                        },
                                        predictions.team1Percentage + '%'
                                    ),
                                    h(
                                        'div',
                                        { className: 'text-xs text-slate-400 uppercase tracking-[0.25em]' },
                                        'Win Probability'
                                    ),
                                    h(
                                        'div',
                                        { className: 'mt-2 text-sm text-sky-300 font-semibold' },
                                        `${predictions.team1Stats.wins}W ‚Ä¢ ${predictions.team1Stats.losses}L`
                                    )
                                )
                                : h(
                                    'div',
                                    { className: 'space-y-2' },
                                    h(
                                        'div',
                                        { className: 'text-xl font-semibold text-sky-300' },
                                        'No Data'
                                    ),
                                    h(
                                        'div',
                                        { className: 'text-xs text-slate-500' },
                                        'Add matches to your data.json to unlock predictions.'
                                    )
                                )
                        ),

                        // VS Badge
                        h(
                            'div',
                            { className: 'flex items-center justify-center' },
                            h(
                                'div',
                                {
                                    className:
                                        'bg-slate-900/80 rounded-full w-24 h-24 flex items-center justify-center ' +
                                        'shadow-[0_0_40px_rgba(139,92,246,0.5)] border border-violet-500/60'
                                },
                                h(
                                    'span',
                                    { className: 'text-slate-50 text-3xl font-black tracking-[0.3em]' },
                                    'VS'
                                )
                            )
                        ),

                        // Team 2 Card
                        h(
                            'div',
                            {
                                className:
                                    'flex-1 bg-slate-900/70 backdrop-blur-xl rounded-3xl p-8 border border-slate-700/70 text-center ' +
                                    'shadow-2xl hover:shadow-fuchsia-900/40 transform hover:-translate-y-1 transition-all'
                            },
                            // Profile Picture
                            h(
                                'div',
                                {
                                    className:
                                        'w-32 h-32 mx-auto mb-6 rounded-3xl bg-gradient-to-br from-fuchsia-500 to-rose-500 ' +
                                        'flex items-center justify-center shadow-2xl overflow-hidden border border-slate-800'
                                },
                                team2.image
                                    ? h('img', {
                                        src: team2.image,
                                        alt: team2.name,
                                        className: 'w-full h-full object-cover',
                                        onError: (e) => {
                                            e.target.style.display = 'none';
                                            e.target.parentElement.innerHTML = '<span class="text-4xl text-white">üèÜ</span>';
                                        }
                                    })
                                    : h('span', { className: 'text-4xl text-white' }, 'üèÜ')
                            ),
                            // Team Name
                            h(
                                'h2',
                                {
                                    className:
                                        'text-3xl font-extrabold text-slate-50 mb-2 tracking-[0.18em] uppercase'
                                },
                                team2.name
                            ),
                            h('p', { className: 'text-xs uppercase tracking-[0.25em] text-slate-500 mb-6' }, 'Team Two'),
                            // Players
                            team2.players &&
                                team2.players.length > 0 &&
                                h(
                                    'div',
                                    { className: 'mb-6 space-y-2' },
                                    team2.players.map((player, idx) =>
                                        h(
                                            'div',
                                            {
                                                key: idx,
                                                className:
                                                    'flex items-center justify-between bg-slate-900/80 rounded-xl px-4 py-2 ' +
                                                    'border border-slate-700/80'
                                            },
                                            h('span', { className: 'text-sm text-slate-100 font-medium' }, player.name),
                                            player.skill &&
                                            h(
                                                'span',
                                                { className: 'ml-2 text-xs text-fuchsia-300 font-semibold' },
                                                'Skill: ' + player.skill
                                            )
                                        )
                                    )
                                ),
                            // Prediction / Stats
                            predictions
                                ? h(
                                    'div',
                                    { className: 'space-y-3' },
                                    h(
                                        'div',
                                        {
                                            className:
                                                'text-5xl font-black text-slate-50 animate-pulse tracking-tight'
                                        },
                                        predictions.team2Percentage + '%'
                                    ),
                                    h(
                                        'div',
                                        { className: 'text-xs text-slate-400 uppercase tracking-[0.25em]' },
                                        'Win Probability'
                                    ),
                                    h(
                                        'div',
                                        { className: 'mt-2 text-sm text-fuchsia-300 font-semibold' },
                                        `${predictions.team2Stats.wins}W ‚Ä¢ ${predictions.team2Stats.losses}L`
                                    )
                                )
                                : h(
                                    'div',
                                    { className: 'space-y-2' },
                                    h(
                                        'div',
                                        { className: 'text-xl font-semibold text-fuchsia-300' },
                                        'No Data'
                                    ),
                                    h(
                                        'div',
                                        { className: 'text-xs text-slate-500' },
                                        'Add matches to your data.json to unlock predictions.'
                                    )
                                )
                        )
                    )
                ),

                // Match History Sidebar (read-only)
                matchHistory.length > 0 &&
                    h(
                        'div',
                        {
                            className:
                                'absolute right-6 top-10 bottom-10 w-80 bg-slate-900/80 backdrop-blur-xl ' +
                                'rounded-2xl p-5 border border-slate-700/70 overflow-y-auto shadow-2xl'
                        },
                        h('h3', { className: 'text-slate-50 font-semibold text-lg mb-3 tracking-wide' }, 'Match History'),
                        h('p', { className: 'text-[0.7rem] text-slate-500 mb-4 uppercase tracking-[0.22em]' },
                            'Data loaded from data.json'
                        ),
                        h(
                            'div',
                            { className: 'space-y-3' },
                            matchHistory.slice(0, 40).map((match, idx) =>
                                h(
                                    'div',
                                    {
                                        key: idx,
                                        className:
                                            'bg-slate-900 rounded-xl p-3 border border-slate-700/80 flex flex-col gap-1'
                                    },
                                    h(
                                        'div',
                                        { className: 'text-xs text-slate-400' },
                                        `${match.team1} vs ${match.team2}`
                                    ),
                                    h(
                                        'div',
                                        { className: 'text-xs font-semibold text-emerald-400' },
                                        `Winner: ${match.winner}`
                                    ),
                                    match.date &&
                                        h(
                                            'div',
                                            { className: 'text-[0.65rem] text-slate-500' },
                                            new Date(match.date).toLocaleString()
                                        )
                                )
                            )
                        )
                    )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('app'));
        root.render(React.createElement(TeamPredictor));
    </script>
</body>
</html>
